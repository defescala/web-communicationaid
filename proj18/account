from flask import Flask, jsonify
from flask_sqlalchemy import SQLAlchemy
from flask import render_template, request, url_for,redirect
from proj18 import Parent, Child, Account, db

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://postgres:regards@localhost/db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = True
db = SQLAlchemy(app)

@app.route('/')
def mode():
    return render_template('mode.html')
@app.route('/user/<acc_id>', methods=['GET'])
def getoneuser(acc_id):
    user = Account.query.filter_by(acc_id=acc_id).first()
    if not user:
        return jsonify({'message: "no user found"'})
    user_data = {}
    user_data['acc_id'] = user.acc_id
    user_data['username'] = user.username
    user_data['email'] = user.email
    user_data['acc_type'] = user.acc_type
    return jsonify({'user': user_data})

@app.route('/parent', methods=['GET'])
def parent(acc_id):
    user = Account.query.filter_by(acc_id=acc_id).first()
    myParent = Parent.query.all()
    return render_template('p_prof.html', myParent=myParent)

@app.route('/edit_parent', methods=['GET','POST'])
def edit_parent():
    if request.method == "POST":
        parent = Parent(request.form['fname_p'], request.form['lname_p'], request.form['bday_p'], request.form['add_p'])
        db.session.add(parent)
        db.session.commit()
        print "hello"
        return redirect('/parent')
    if request.method == "GET":
        return render_template('edit_p.html')

@app.route('/child', methods=['GET'])
def child():
    myChild = Child.query.all()
    return render_template('c_prof.html', myChild=myChild)

@app.route('/edit_child', methods=['GET','POST'])
def edit_child():
    if request.method == "POST":
        child = Child(request.form['fname_c'], request.form['lname_c'], request.form['bday_c'], request.form['diagnosis'])
        db.session.add(child)
        db.session.commit()
        print "hello"
        return redirect('/child')
    if request.method == "GET":
        return render_template('edit_c.html')


# @app.route('/edit_parent', method=['POST'])
# def edit_parent():


if __name__ == "__main__":
    app.run(debug=True)